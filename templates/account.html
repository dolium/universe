{% extends "base.html" %}

{% block title %}Account - {{ user.name }} - {{ site_name }}{% endblock %}

{% block content %}
<section class="account-page">
  <div class="container">
    <h1 style="margin-bottom:20px">{{ user.name }}'s Account</h1>
    
    <div class="panel" style="margin-bottom:30px">
      <h3>Profile Information</h3>
      <p><strong>Name:</strong> {{ user.name }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
    </div>
    
    <div class="panel">
      <h3>Materials Added by {{ user.name }}</h3>
      {% if materials and materials|length > 0 %}
        <p style="margin-bottom:20px">Total materials contributed: <strong>{{ materials|length }}</strong></p>
        <ul class="resource-list">
          {% for material in materials %}
            <li style="margin-bottom:15px">
              <div>
                <div style="display:flex;align-items:center;gap:8px">
                  <a href="{{ material.url }}" target="_blank" rel="noopener" style="font-size:16px;font-weight:500">{{ material.title }}</a>
                  {% if material.verified %}
                  <span class="verified-badge" title="Officially Verified" style="display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;background:#4f46e5;border-radius:50%;color:#fff;font-size:10px;font-weight:bold">✓</span>
                  {% endif %}
                </div>
                <p style="margin:5px 0;color:#888;font-size:14px">
                  Course: <a href="{{ url_for('course_detail', slug=material.course_slug) }}">{{ material.course_name }}</a>
                </p>
                {% if material.rating > 0 %}
                <p style="margin:5px 0;color:#ffd700;font-size:14px">
                  {% set full_stars = material.rating|int %}
                  {% set has_half_star = (material.rating - full_stars) >= 0.5 %}
                  {% for i in range(full_stars) %}★{% endfor %}{% if has_half_star %}☆{% endif %}
                  <span style="color:#888">{{ material.rating|round(1) }}/5 ({{ material.rating_count }} ratings)</span>
                </p>
                {% else %}
                <p style="margin:5px 0;color:#888;font-size:14px">No ratings yet</p>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">
          {% if is_own_account %}
            You haven't added any materials yet. Visit course pages to share materials with the community!
          {% else %}
            This user hasn't added any materials yet.
          {% endif %}
        </p>
      {% endif %}
    </div>
    
    <!-- Profile Comments Section -->
    <div class="panel" style="margin-top:30px">
      <h3>Comments on {{ user.name }}'s Profile</h3>
      
      <!-- Add Comment Form (only for logged-in users) -->
      {% if current_user.is_authenticated %}
        <form method="post" action="{{ url_for('add_comment') }}" style="margin-bottom:30px;padding:20px;background:#2a2a2a;border-radius:8px">
          <input type="hidden" name="comment_type" value="profile" />
          <input type="hidden" name="reference_id" value="{{ user.email }}" />
          <div style="margin-bottom:15px">
            <label for="comment_text" style="display:block;margin-bottom:8px;font-weight:500">Add a comment:</label>
            <textarea 
              id="comment_text" 
              name="comment_text" 
              required
              rows="4"
              placeholder="Share your thoughts about {{ user.name }}..."
              style="width:100%;padding:10px;border:1px solid #444;border-radius:5px;background:#1a1a1a;color:#fff;resize:vertical"
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
      {% else %}
        <p style="margin-bottom:20px;padding:15px;background:#2a2a2a;border-radius:5px;color:#888">
          <a href="{{ url_for('login') }}">Log in</a> to leave a comment on this profile.
        </p>
      {% endif %}
      
      <!-- Display Comments -->
      {% if comments and comments|length > 0 %}
        <div class="comments-list">
          {% for comment in comments %}
            <div class="comment" style="padding:15px;margin-bottom:15px;background:#2a2a2a;border-radius:8px;border-left:3px solid #667eea">
              <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px">
                <div>
                  <strong style="color:#667eea">{{ comment.author_name }}</strong>
                  <span style="color:#888;font-size:13px;margin-left:10px">{{ comment.created }}</span>
                </div>
              </div>
              <p style="margin:0;color:#ddd;line-height:1.6">{{ comment.comment }}</p>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">No comments yet. Be the first to leave a comment!</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
